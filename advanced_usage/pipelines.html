

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Pipelines &mdash; MLBlocks 0.3.0-dev documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Adding Primitives" href="adding_primitives.html" />
    <link rel="prev" title="Hyperparameters" href="hyperparameters.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> MLBlocks
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">What is MLBlocks?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/quickstart.html">Quickstart</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced Usage</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="primitives.html">Primitives</a><ul>
<li class="toctree-l2"><a class="reference internal" href="primitives.html#what-is-a-primitive">What is a Primitive?</a></li>
<li class="toctree-l2"><a class="reference internal" href="primitives.html#json-annotations">JSON Annotations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="primitives.html#function-primitives">Function Primitives</a></li>
<li class="toctree-l3"><a class="reference internal" href="primitives.html#class-primitives">Class Primitives</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="primitives.html#the-mlblock-class">The MLBlock Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hyperparameters.html">Hyperparameters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hyperparameters.html#fixed-hyperparameters">Fixed Hyperparameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="hyperparameters.html#tunable-hyperparameters">Tunable Hyperparameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="hyperparameters.html#special-hyperparameter-types">Special Hyperparameter Types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="hyperparameters.html#multitype-hyperparameters">Multitype Hyperparameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="hyperparameters.html#conditional-hyperparameters">Conditional Hyperparameters</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Pipelines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-a-pipeline">What is a Pipeline?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-mlpipeline-class">The MLPipeline Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#block-names">Block Names</a></li>
<li class="toctree-l3"><a class="reference internal" href="#init-arguments">Init Arguments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#context">Context</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#context-usage-examples">Context Usage Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#json-annotations">JSON Annotations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#representing-a-pipeline-as-a-dict">Representing a  Pipeline as a dict</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-a-pipeline-from-a-dict">Loading a Pipeline from a dict</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="adding_primitives.html">Adding Primitives</a><ul>
<li class="toctree-l2"><a class="reference internal" href="adding_primitives.html#mlprimitives">MLPrimitives</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding_primitives.html#writing-primitives">Writing Primitives</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding_primitives.html#primitives-lookup">Primitives Lookup</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding_primitives.html#adding-a-primitives-folder">Adding a Primitives Folder</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding_primitives.html#developing-a-primitives-library">Developing a Primitives Library</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Pipeline Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pipeline_examples/single_table.html">Single Table Pipelines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../pipeline_examples/single_table.html#regression-pipeline">Regression Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pipeline_examples/single_table.html#classification-pipeline">Classification Pipeline</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pipeline_examples/multi_table.html">Multi Table Pipelines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../pipeline_examples/multi_table.html#multi-table-classification-pipeline">Multi Table Classification Pipeline</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pipeline_examples/text.html">Text Pipelines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../pipeline_examples/text.html#text-classification">Text Classification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pipeline_examples/text.html#mlprimitives-keras-preprocessing-keras-lstm">MLPrimitives + Keras Preprocessing + Keras LSTM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pipeline_examples/text.html#tabular-data-with-text">Tabular Data with Text</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pipeline_examples/text.html#mlprimitives-scikit-learn-randomforestclassifier">MLPrimitives + Scikit-learn RandomForestClassifier</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pipeline_examples/image.html">Image Pipelines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../pipeline_examples/image.html#image-classification">Image Classification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pipeline_examples/image.html#opencv-gaussianblur-scikit-image-hog-scikit-learn-randomforestclassifier">OpenCV GaussianBlur + Scikit-image HOG + Scikit-Learn RandomForestClassifier</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pipeline_examples/image.html#opencv-gaussianblur-keras-single-layer-cnn">OpenCV GaussianBlur + Keras Single Layer CNN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pipeline_examples/image.html#image-regression">Image Regression</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pipeline_examples/image.html#keras-mobilenet-xgbregressor">Keras MobileNet + XGBRegressor</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pipeline_examples/graph.html">Graph Pipelines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../pipeline_examples/graph.html#link-prediction">Link Prediction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../pipeline_examples/graph.html#networkx-mlprimitives-scikit-learn-xgboost">NetworkX + MLPrimitives + Scikit-learn + XGBoost</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/mlblocks.html">mlblocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/mlblocks.datasets.html">mlblocks.datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/mlblocks.primitives.html">mlblocks.primitives</a></li>
</ul>
<p class="caption"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MLBlocks</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Pipelines</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/HDI-Project/MLBlocks/blob/master/docs/advanced_usage/pipelines.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pipelines">
<h1>Pipelines<a class="headerlink" href="#pipelines" title="Permalink to this headline">¶</a></h1>
<p>The overall goal of <strong>MLBlocks</strong> is to be able to build <strong>Pipelines</strong>.</p>
<div class="section" id="what-is-a-pipeline">
<h2>What is a Pipeline?<a class="headerlink" href="#what-is-a-pipeline" title="Permalink to this headline">¶</a></h2>
<p>A <strong>Pipeline</strong> is a sequence of <a class="reference external" href="../primitives.html">primitives</a> working together to learn from training data and
later on make predictions on new data as if they were a single object.</p>
<div class="graphviz"><img src="../_images/graphviz-45bfb948b6a00a900e1c8d8a92b006768feb8436.png" alt="digraph {
    rankdir=LR;
    &quot;Input Data&quot; -&gt; &quot;Pipeline&quot;;
    &quot;Pipeline&quot; -&gt; &quot;Predictions&quot;;
}" class="graphviz" /></div>
<p>Pipelines can have any possible composition, but the typical setup includes data cleanup,
feature extraction and feature selection <a class="reference external" href="../primitives.html">primitives</a>, and ends up with one or more estimator
<a class="reference external" href="../primitives.html">primitives</a> that generate the final predictions.</p>
<div class="graphviz"><img src="../_images/graphviz-42eef239691ae1b181822dc50b0cd50a99aaecb5.png" alt="digraph {
    rankdir=LR;
    subgraph cluster {
        &quot;Data Cleanup&quot; -&gt; &quot;Feature Extraction&quot; -&gt; &quot;Feature Selection&quot; -&gt; &quot;Estimator&quot;;
        label = &quot;pipeline&quot;;
        color=blue
    }
}" class="graphviz" /></div>
<p>Also, just like <a class="reference external" href="../primitives.html">primitives</a>, pipelines have <a class="reference external" href="hyperparameters.html">hyperparameters</a>, which are nothing but the list
of hyperparameters that the <a class="reference external" href="../primitives.html">primitives</a> that compose them expect, and which can be also tuned to
improve their prediction performance.</p>
</div>
<div class="section" id="the-mlpipeline-class">
<h2>The MLPipeline Class<a class="headerlink" href="#the-mlpipeline-class" title="Permalink to this headline">¶</a></h2>
<p>In <strong>MLBlocks</strong>, a pipeline is represented by the <a class="reference external" href="../api_reference.html#mlblocks.MLPipeline">mlblocks.MLPipeline</a> class, which combines
multiple <a class="reference external" href="../api_reference.html#mlblocks.MLBlock">mlblocks.MLBlock</a> instances, called <code class="docutils literal notranslate"><span class="pre">blocks</span></code> in this context, and calls them in
succession for fitting and predicting.</p>
<p>As you have seen in the <a class="reference external" href="../getting_started/quickstart.html">quickstart tutorial</a>, You can create an MLPipeline by simply
passing it the list of primitives that will compose it:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">mlblocks</span> <span class="kn">import</span> <span class="n">MLPipeline</span>

<span class="gp">In [2]: </span><span class="n">primitives</span> <span class="o">=</span> <span class="p">[</span>
<span class="gp">   ...: </span>    <span class="s1">&#39;sklearn.preprocessing.StandardScaler&#39;</span><span class="p">,</span>
<span class="gp">   ...: </span>    <span class="s1">&#39;sklearn.ensemble.RandomForestClassifier&#39;</span>
<span class="gp">   ...: </span><span class="p">]</span>
<span class="gp">   ...: </span>

<span class="gp">In [3]: </span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">MLPipeline</span><span class="p">(</span><span class="n">primitives</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="block-names">
<h3>Block Names<a class="headerlink" href="#block-names" title="Permalink to this headline">¶</a></h3>
<p>When the MLPipeline is created, a list of MLBlock instances has been created inside it.</p>
<p>Each of this blocks is given a unique name which is composed by the primitive name and a counter,
separated by a hash symbol <code class="docutils literal notranslate"><span class="pre">#</span></code>, allowing multiple blocks for the same primitive to exist
within a single MLPipeline:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="nb">dict</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">blocks</span><span class="p">)</span>
<span class="gh">Out[4]: </span><span class="go"></span>
<span class="go">{&#39;sklearn.preprocessing.StandardScaler#1&#39;: &lt;mlblocks.mlblock.MLBlock at 0x2b55d62040f0&gt;,</span>
<span class="go"> &#39;sklearn.ensemble.RandomForestClassifier#1&#39;: &lt;mlblocks.mlblock.MLBlock at 0x2b55d643a588&gt;}</span>
</pre></div>
</div>
</div>
<div class="section" id="init-arguments">
<h3>Init Arguments<a class="headerlink" href="#init-arguments" title="Permalink to this headline">¶</a></h3>
<p>Sometimes, additional arguments need to be passed to the blocks during initialization.</p>
<p>This can be done by passing an extra dictionary to the MLPipeline when it is created:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="n">init_params</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">   ...: </span>    <span class="s1">&#39;sklearn.preprocessing.StandardScaler&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">   ...: </span>        <span class="s1">&#39;with_mean&#39;</span><span class="p">:</span> <span class="bp">False</span>
<span class="gp">   ...: </span>    <span class="p">},</span>
<span class="gp">   ...: </span>    <span class="s1">&#39;sklearn.ensemble.RandomForestClassifier&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">   ...: </span>        <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">100</span>
<span class="gp">   ...: </span>    <span class="p">}</span>
<span class="gp">   ...: </span><span class="p">}</span>
<span class="gp">   ...: </span>

<span class="gp">In [6]: </span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">MLPipeline</span><span class="p">(</span><span class="n">primitives</span><span class="p">,</span> <span class="n">init_params</span><span class="p">)</span>
</pre></div>
</div>
<p>This dictionary must have as keys the name of the blocks that the arguments belong to, and
as values the dictionary that contains the argument names and their values.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If only one block of a specific primitive exists in the pipeline, the counter
appended to its name can be skipped when specifying the arguments, as shown in the
example.</p>
</div>
</div>
</div>
<div class="section" id="context">
<h2>Context<a class="headerlink" href="#context" title="Permalink to this headline">¶</a></h2>
<p>One element that plays an important role during the execution of the <a class="reference external" href="../api_reference.html#mlblocks.MLPipeline.fit">fit</a> and <a class="reference external" href="../api_reference.html#mlblocks.MLPipeline.predict">predict</a>
methods of a pipeline is the <strong>Context dictionary</strong>.</p>
<p>Each time any of these methods is called, a context dictionary is internally created and all
the variables passed to the method are stored in it.</p>
<p>Then, the following happens for each block:</p>
<ul class="simple">
<li>The list of arguments that the method expects is retrieved from the block configuration.</li>
<li>The corresponding values are read from the <strong>Context</strong> and passed to the method.</li>
<li>The list of outputs that the method returns is retrieved from the block configuration.</li>
<li>The indicated outputs are captured in order and put back to the <strong>Context</strong> dictionary
using the name specified.</li>
</ul>
<div class="section" id="context-usage-examples">
<h3>Context Usage Examples<a class="headerlink" href="#context-usage-examples" title="Permalink to this headline">¶</a></h3>
<p>The most simple version of this schema is one where all the blocks expect a single feature
matrix as input, called <cite>X</cite>, and output another feature matrix, also called <cite>X</cite>, until the last
one, which outputs the final prediction, called <cite>y</cite>.</p>
<p>In this case, supposing that we only have 3 blocks, the sequence when the <code class="docutils literal notranslate"><span class="pre">pipeline.predict(X)</span></code>
call is issued would be:</p>
<ol class="arabic simple">
<li>The value of <code class="docutils literal notranslate"><span class="pre">X</span></code> is stored in the <strong>Context</strong>.</li>
<li>The value of <code class="docutils literal notranslate"><span class="pre">X</span></code> is pulled from the <strong>Context</strong> and passed to <cite>block1</cite>.</li>
<li>The output from <cite>block1</cite> is put back into the <strong>Context</strong>, overwriting the old value.</li>
<li>The value of <code class="docutils literal notranslate"><span class="pre">X</span></code> is pulled again from the <strong>Context</strong> and passed to <cite>block2</cite>.</li>
<li>The output from <cite>block2</cite> is put back into the <strong>Context</strong>, overwriting again the old value.</li>
<li>The value of <code class="docutils literal notranslate"><span class="pre">X</span></code> is pulled for the last time from the <strong>Context</strong> and passed to <cite>block3</cite>.</li>
<li>The output from <cite>block3</cite>, since it is the last one, is returned.</li>
</ol>
<div class="graphviz"><img src="../_images/graphviz-b3981e4480a82cc9f77d01d9337416ff795e60e5.png" alt="digraph G {
    subgraph cluster_0 {
        label = &quot;pipeline.predict(X)&quot;;

        b1 [label=&quot;block1.produce(X)&quot;];
        b2 [label=&quot;block2.produce(X)&quot;];
        b3 [label=&quot;block3.produce(X)&quot;];

        b1 -&gt; b2 -&gt; b3 [style=invis];

        subgraph cluster_1 {
            X1 [label=X];
            X2 [label=X];
            X3 [label=X];
            X1 -&gt; X2 -&gt; X3 [style=&quot;dashed&quot;];
            label = &quot;Context&quot;;
        }

    }

    X -&gt; X1;
    X1 -&gt; b1 [constraint=false];
    b1 -&gt; X2;
    X2 -&gt; b2 [constraint=false];
    b2 -&gt; X3;
    X3 -&gt; b3 [constraint=false];
    b3 -&gt; y;
}" class="graphviz" /></div>
<p>Another schema with some more complexity would be one where there is one primitive that
needs to be passed an additional argument that provides information about the data.</p>
<p>Suppose, for example, that there is a primitive that encodes categorical features, but
it needs to be given the list of features that it needs to encode in a variable called
<code class="docutils literal notranslate"><span class="pre">features</span></code>. Suppose also that this primitive is followed directly by an estimator primitive.</p>
<p>In this case, the call would be <code class="docutils literal notranslate"><span class="pre">pipeline.predict(X,</span> <span class="pre">features=features)</span></code>, and the sequence
of actions would be:</p>
<ol class="arabic simple">
<li>The value of <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">features</span></code> is stored in the <strong>Context</strong>.</li>
<li>The value of <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">features</span></code> is pulled from the <strong>Context</strong> and passed to the
<cite>encoder</cite> block.</li>
<li>The output from <cite>encoder</cite> is put back into the <strong>Context</strong> as <code class="docutils literal notranslate"><span class="pre">X</span></code>, overwriting the old value.</li>
<li>The value of <code class="docutils literal notranslate"><span class="pre">X</span></code> is pulled again from the <strong>Context</strong> and passed to the <cite>estimator</cite> block.</li>
<li>The output from the <cite>estimator</cite> block is returned.</li>
</ol>
<div class="graphviz"><img src="../_images/graphviz-30b772283c09a682c0839163ff176f99cc84d262.png" alt="digraph G {
    subgraph cluster_0 {
        label = &quot;pipeline.predict(X, features=features)&quot;;

        b1 [label=&quot;encoder.produce(X, features=features)&quot;];
        b2 [label=&quot;estimator.produce(X)&quot;];

        b1 -&gt; b2 [style=invis];

        subgraph cluster_1 {
            {rank=same X1 f1}
            X1 [label=X group=c];
            f1 [label=features group=c];
            X2 [label=X group=c];
            f1 -&gt; X1 [style=invis];
            X1 -&gt; X2 [style=dashed];
            label = &quot;Context&quot;;
        }

    }

    {rank=same X features}
    features -&gt; f1;
    X -&gt; X1;
    X1 -&gt; b1 [constraint=false];
    f1 -&gt; b1 [constraint=false];
    b1 -&gt; X2;
    X2 -&gt; b2 [constraint=false]
    b2 -&gt; y
}" class="graphviz" /></div>
<p>But, what if we also have a primitive, which we will call <cite>detector</cite>, that detects which features
are categorical and want to use it instead of passing a manually crafted list of features?</p>
<p>We can also achieve it using the <strong>Context</strong>!</p>
<p>In this case, we go back to the <code class="docutils literal notranslate"><span class="pre">pipeline.predict(X)</span></code> call, and let the <cite>detector</cite> primitive
do its job:</p>
<ol class="arabic simple">
<li>The value of <code class="docutils literal notranslate"><span class="pre">X</span></code> is stored in the <strong>Context</strong>.</li>
<li>The value of <code class="docutils literal notranslate"><span class="pre">X</span></code> is pulled from the <strong>Context</strong> and passed to the <cite>detector</cite> block.</li>
<li>The output from the <cite>detector</cite> block is stored in the <strong>Context</strong> as the <cite>features</cite> variable.</li>
<li>The value of <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">features</span></code> is pulled from the <strong>Context</strong> and passed to the
<cite>encoder</cite> block.</li>
<li>The output from <cite>encoder</cite> is put back into the <strong>Context</strong> as <code class="docutils literal notranslate"><span class="pre">X</span></code>, overwriting the old value.</li>
<li>The value of <code class="docutils literal notranslate"><span class="pre">X</span></code> is pulled again from the <strong>Context</strong> and passed to the <cite>estimator</cite> block.</li>
<li>The output from the <cite>estimator</cite> block is returned.</li>
</ol>
<div class="graphviz"><img src="../_images/graphviz-74f15df84efdedb1488bfe2b184fbe7cecd8355d.png" alt="digraph G {
    subgraph cluster_0 {
        label = &quot;pipeline.predict(X)&quot;;

        b0 [label=&quot;detector.produce(X)&quot;];
        b1 [label=&quot;encoder.produce(X, features=features)&quot;];
        b2 [label=&quot;estimator.produce(X)&quot;];

        b0 -&gt; b1 -&gt; b2 [style=invis];

        subgraph cluster_1 {
            X1 [label=X group=c];
            f1 [label=features group=c];
            X2 [label=X group=c];
            X1 -&gt; f1 -&gt; X2 [style=invis];
            X1 -&gt; X2 [style=dashed];
            label = &quot;Context&quot;;
        }

    }

    X -&gt; X1;
    X1 -&gt; b0 [constraint=false];
    b0 -&gt; f1;
    {X1 f1} -&gt; b1 [constraint=false];
    b1 -&gt; X2;
    X2 -&gt; b2 [constraint=false]
    b2 -&gt; y
}" class="graphviz" /></div>
</div>
</div>
<div class="section" id="json-annotations">
<h2>JSON Annotations<a class="headerlink" href="#json-annotations" title="Permalink to this headline">¶</a></h2>
<p>Like primitives, Pipelines can also be annotated and stored as dicts or JSON files that contain
the different arguments expected by the <code class="docutils literal notranslate"><span class="pre">MLPipeline</span></code> class, as well as the set hyperparameters
and tunable hyperparameters.</p>
<div class="section" id="representing-a-pipeline-as-a-dict">
<h3>Representing a  Pipeline as a dict<a class="headerlink" href="#representing-a-pipeline-as-a-dict" title="Permalink to this headline">¶</a></h3>
<p>The dict representation of an Pipeline can be obtained directly from an <code class="docutils literal notranslate"><span class="pre">MLPipeline</span></code> instance,
by calling its <code class="docutils literal notranslate"><span class="pre">to_dict</span></code> method.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [7]: </span><span class="n">pipeline</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="gh">Out[7]: </span><span class="go"></span>
<span class="go">{&#39;primitives&#39;: [&#39;sklearn.preprocessing.StandardScaler&#39;,</span>
<span class="go">  &#39;sklearn.ensemble.RandomForestClassifier&#39;],</span>
<span class="go"> &#39;init_params&#39;: {&#39;sklearn.preprocessing.StandardScaler&#39;: {&#39;with_mean&#39;: False},</span>
<span class="go">  &#39;sklearn.ensemble.RandomForestClassifier&#39;: {&#39;n_estimators&#39;: 100}},</span>
<span class="go"> &#39;input_names&#39;: {},</span>
<span class="go"> &#39;output_names&#39;: {},</span>
<span class="go"> &#39;hyperparameters&#39;: {&#39;sklearn.preprocessing.StandardScaler#1&#39;: {&#39;with_mean&#39;: False,</span>
<span class="go">   &#39;with_std&#39;: True},</span>
<span class="go">  &#39;sklearn.ensemble.RandomForestClassifier#1&#39;: {&#39;n_jobs&#39;: None,</span>
<span class="go">   &#39;verbose&#39;: 0,</span>
<span class="go">   &#39;warm_start&#39;: False,</span>
<span class="go">   &#39;class_weight&#39;: None,</span>
<span class="go">   &#39;n_estimators&#39;: 100,</span>
<span class="go">   &#39;criterion&#39;: &#39;gini&#39;,</span>
<span class="go">   &#39;max_features&#39;: None,</span>
<span class="go">   &#39;max_depth&#39;: None,</span>
<span class="go">   &#39;min_samples_split&#39;: 2,</span>
<span class="go">   &#39;min_samples_leaf&#39;: 1,</span>
<span class="go">   &#39;min_weight_fraction_leaf&#39;: 0.0,</span>
<span class="go">   &#39;max_leaf_nodes&#39;: None,</span>
<span class="go">   &#39;min_impurity_decrease&#39;: 0.0,</span>
<span class="go">   &#39;bootstrap&#39;: True,</span>
<span class="go">   &#39;oob_score&#39;: False}},</span>
<span class="go"> &#39;tunable_hyperparameters&#39;: {&#39;sklearn.preprocessing.StandardScaler#1&#39;: {&#39;with_std&#39;: {&#39;type&#39;: &#39;bool&#39;,</span>
<span class="go">    &#39;default&#39;: True}},</span>
<span class="go">  &#39;sklearn.ensemble.RandomForestClassifier#1&#39;: {&#39;criterion&#39;: {&#39;type&#39;: &#39;str&#39;,</span>
<span class="go">    &#39;default&#39;: &#39;gini&#39;,</span>
<span class="go">    &#39;values&#39;: [&#39;entropy&#39;, &#39;gini&#39;]},</span>
<span class="go">   &#39;max_features&#39;: {&#39;type&#39;: &#39;str&#39;,</span>
<span class="go">    &#39;default&#39;: None,</span>
<span class="go">    &#39;values&#39;: [None, &#39;auto&#39;, &#39;log2&#39;, &#39;sqrt&#39;]},</span>
<span class="go">   &#39;max_depth&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;default&#39;: None, &#39;range&#39;: [1, 30]},</span>
<span class="go">   &#39;min_samples_split&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;default&#39;: 2, &#39;range&#39;: [2, 100]},</span>
<span class="go">   &#39;min_samples_leaf&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;default&#39;: 1, &#39;range&#39;: [1, 100]},</span>
<span class="go">   &#39;min_weight_fraction_leaf&#39;: {&#39;type&#39;: &#39;float&#39;,</span>
<span class="go">    &#39;default&#39;: 0.0,</span>
<span class="go">    &#39;range&#39;: [0.0, 0.5]},</span>
<span class="go">   &#39;max_leaf_nodes&#39;: {&#39;type&#39;: &#39;int&#39;, &#39;default&#39;: None, &#39;range&#39;: [2, 1000]},</span>
<span class="go">   &#39;min_impurity_decrease&#39;: {&#39;type&#39;: &#39;float&#39;,</span>
<span class="go">    &#39;default&#39;: 0.0,</span>
<span class="go">    &#39;range&#39;: [0.0, 1000.0]},</span>
<span class="go">   &#39;bootstrap&#39;: {&#39;type&#39;: &#39;bool&#39;, &#39;default&#39;: True},</span>
<span class="go">   &#39;oob_score&#39;: {&#39;type&#39;: &#39;bool&#39;, &#39;default&#39;: False}}}}</span>
</pre></div>
</div>
<p>Notice how the dict includes all the arguments that used when we created the <code class="docutils literal notranslate"><span class="pre">MLPipeline</span></code>,
as well as the hyperparameters that the pipeline is currently using and the complete specification
of the tunable hypeparameters.</p>
<p>If we want to directly store the dict as a JSON we can do so by calling the <code class="docutils literal notranslate"><span class="pre">save</span></code> method
with the path of the JSON file to create.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [8]: </span><span class="n">pipeline</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;pipeline.json&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-a-pipeline-from-a-dict">
<h3>Loading a Pipeline from a dict<a class="headerlink" href="#loading-a-pipeline-from-a-dict" title="Permalink to this headline">¶</a></h3>
<p>Similarly, once the we have a dict specification, we can load the Pipeline directly from it
by calling the <code class="docutils literal notranslate"><span class="pre">MLPipeline.from_dict</span></code> method.</p>
<p>Bear in mind that the hyperparameter values and tunable ranges will be taken from the dict.
This means that if we want to tweak the tunable hyperparameters to adjust it to a specific
problem or dataset, we can do that directly on our dict representation.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [9]: </span><span class="n">pipeline_dict</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">   ...: </span>    <span class="s2">&quot;primitives&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="gp">   ...: </span>        <span class="s2">&quot;sklearn.preprocessing.StandardScaler&quot;</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="s2">&quot;sklearn.ensemble.RandomForestClassifier&quot;</span>
<span class="gp">   ...: </span>    <span class="p">],</span>
<span class="gp">   ...: </span>    <span class="s2">&quot;hyperparameters&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">   ...: </span>        <span class="s2">&quot;sklearn.ensemble.RandomForestClassifier#1&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">   ...: </span>            <span class="s2">&quot;n_jobs&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="gp">   ...: </span>            <span class="s2">&quot;n_estimators&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<span class="gp">   ...: </span>            <span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
<span class="gp">   ...: </span>        <span class="p">}</span>
<span class="gp">   ...: </span>    <span class="p">},</span>
<span class="gp">   ...: </span>    <span class="s2">&quot;tunable_hyperparameters&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">   ...: </span>        <span class="s2">&quot;sklearn.ensemble.RandomForestClassifier#1&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">   ...: </span>            <span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">   ...: </span>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span>
<span class="gp">   ...: </span>                <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
<span class="gp">   ...: </span>                <span class="s2">&quot;range&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="gp">   ...: </span>                    <span class="mi">1</span><span class="p">,</span>
<span class="gp">   ...: </span>                    <span class="mi">30</span>
<span class="gp">   ...: </span>                <span class="p">]</span>
<span class="gp">   ...: </span>            <span class="p">}</span>
<span class="gp">   ...: </span>        <span class="p">}</span>
<span class="gp">   ...: </span>    <span class="p">}</span>
<span class="gp">   ...: </span><span class="p">}</span>
<span class="gp">   ...: </span>

<span class="gp">In [10]: </span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">MLPipeline</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">pipeline_dict</span><span class="p">)</span>

<span class="gp">In [11]: </span><span class="n">pipeline</span><span class="o">.</span><span class="n">get_hyperparameters</span><span class="p">()</span>
<span class="gh">Out[11]: </span><span class="go"></span>
<span class="go">{&#39;sklearn.preprocessing.StandardScaler#1&#39;: {&#39;with_mean&#39;: True,</span>
<span class="go">  &#39;with_std&#39;: True},</span>
<span class="go"> &#39;sklearn.ensemble.RandomForestClassifier#1&#39;: {&#39;n_jobs&#39;: -1,</span>
<span class="go">  &#39;verbose&#39;: 0,</span>
<span class="go">  &#39;warm_start&#39;: False,</span>
<span class="go">  &#39;class_weight&#39;: None,</span>
<span class="go">  &#39;n_estimators&#39;: 100,</span>
<span class="go">  &#39;criterion&#39;: &#39;gini&#39;,</span>
<span class="go">  &#39;max_features&#39;: None,</span>
<span class="go">  &#39;max_depth&#39;: 5,</span>
<span class="go">  &#39;min_samples_split&#39;: 2,</span>
<span class="go">  &#39;min_samples_leaf&#39;: 1,</span>
<span class="go">  &#39;min_weight_fraction_leaf&#39;: 0.0,</span>
<span class="go">  &#39;max_leaf_nodes&#39;: None,</span>
<span class="go">  &#39;min_impurity_decrease&#39;: 0.0,</span>
<span class="go">  &#39;bootstrap&#39;: True,</span>
<span class="go">  &#39;oob_score&#39;: False}}</span>

<span class="gp">In [12]: </span><span class="n">pipeline</span><span class="o">.</span><span class="n">get_tunable_hyperparameters</span><span class="p">()</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Out[12]: </span>
<span class="go">{&#39;sklearn.ensemble.RandomForestClassifier#1&#39;: {&#39;max_depth&#39;: {&#39;type&#39;: &#39;int&#39;,</span>
<span class="go">   &#39;default&#39;: 10,</span>
<span class="go">   &#39;range&#39;: [1, 30]}}}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notice how we skipped many items in this last dict representation and only included
the parts that we want to be different than the default values. MLBlocks will figure out
the rest of the elements directly from the primitive annotations on its own!</p>
</div>
<p>Like with the <code class="docutils literal notranslate"><span class="pre">save</span></code> method, the <strong>MLPipeline</strong> class offers a convenience <code class="docutils literal notranslate"><span class="pre">load</span></code> method
that allows loading the pipeline directly from a JSON file:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [13]: </span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">MLPipeline</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;pipeline.json&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="adding_primitives.html" class="btn btn-neutral float-right" title="Adding Primitives" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="hyperparameters.html" class="btn btn-neutral" title="Hyperparameters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, MIT Data To AI Lab

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>